<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    
    <style>
        input
        {
            width: 30px;
            
            border: 2px solid #dfdfdf71;
            border-radius: 5px;
            background-color: white;
        }
        
        input:invalid
        {
            border: rgb(255, 215, 215) solid 3px;
        }
        
        input:valid
        {
            border: #ddffdd solid 3px;
        }
    </style>
    
</head>
<body>
    <input id="sessionStartHours" type="text" pattern="([01][0-9])|(2[0-3])"> : <input id="sessionStartMinutes" type="text" pattern="([0-5][0-9])">
     - 
     <input id="sessionEndHours" type="text" pattern="([01][0-9])|(2[0-4])"> : <input id="sessionEndMinutes" type="text" pattern="([0-5][0-9])">
    <button id="addSession" onclick="addSessionTime()">Add</button>
    
    <ul id="times">
        <? for (var i = 0; i < times.length; i++) { ?>
            <li>
                <?= times[i].start.hours ?>:<?= times[i].start.minutes ?> - <?= times[i].end.hours ?>:<?= times[i].end.minutes ?><button onclick="removeSessionTime(<?= i ?>)"> Delete </button>
            </li>
        <? } ?>
    </ul>
    
    <script>
        function addSessionTime()
        {
            if(!isSessionTimeValid()) return;
            
            let sessionStartHours = document.getElementById("sessionStartHours");
            let sessionStartMinutes = document.getElementById("sessionStartMinutes");
            let sessionEndHours = document.getElementById("sessionEndHours");
            let sessionEndMinutes = document.getElementById("sessionEndMinutes");
            
            let session = 
            {
                start :
                {
                    hours: sessionStartHours.value,
                    minutes: sessionStartMinutes.value
                },
                end : 
                {
                    hours: sessionEndHours.value,
                    minutes: sessionEndMinutes.value
                }
            }
                     
            google.script.run.withSuccessHandler(
                (sessions) =>
                {
                    updateList(sessions);
                }
            )
            .addToArrayProperty("times", session);
            
            
        }
        
        function removeSessionTime(index)
        {  
            let indexNum = parseInt(index);
            
            google.script.run.withSuccessHandler(
                (sessions) =>
                {
                    updateList(sessions);
                }
            )
            .removeFromArrayProperty("times", indexNum);
        }
        
        function getSessionsAsItems(items)
        {
            let sessions = [];
                    
            items.forEach(
                (session, index) => 
                {
                    let child = document.createElement("li");
                    let text = document.createTextNode(`${session.start.hours}:${session.start.minutes} - ${session.end.hours}:${session.end.minutes}`)
                    let button = document.createElement("button");
                    button.onclick = () => removeSessionTime(index);
                    button.innerText = "Delete";
                    child.appendChild(text);
                    child.appendChild(button);
                    
                    sessions.push(child);
                }
            );
            
            return sessions;
        }
        
        function updateList(sessions)
        {
            let list = document.getElementById("times");
                    
            while (list.firstChild)
            {
                list.removeChild(list.lastChild);
            }
            
            let children = getSessionsAsItems(sessions);
            
            children.forEach(
                (child) =>
                {
                    list.appendChild(child);
                }
            )
        }
        
        function isSessionTimeValid(sessionTime)
        {
            let sessionStartHours = document.getElementById("sessionStartHours");
            let sessionStartMinutes = document.getElementById("sessionStartMinutes");
            let sessionEndHours = document.getElementById("sessionEndHours");
            let sessionEndMinutes = document.getElementById("sessionEndMinutes");
            
            if(
                !sessionStartHours.checkValidity() || 
                !sessionStartMinutes.checkValidity() || 
                !sessionEndHours.checkValidity() || 
                !sessionEndMinutes.checkValidity())
            {
                return false;
            }
            else
            {
                return true;
            }
        }
    </script>
</body>
</html>